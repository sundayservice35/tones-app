<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Hardbody Resonance</title>
  <meta name="theme-color" content="#0f172a">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%230f172a'/%3E%3Ccircle cx='256' cy='256' r='190' fill='%233b82f6'/%3E%3Ccircle cx='256' cy='256' r='120' fill='%2394a3b8'/%3E%3C/svg%3E">
  <style>
    :root{--bg:#0b1020;--fg:#e5e7eb;--muted:#94a3b8;--accent:#60a5fa;--accent2:#22d3ee;--card:#111827;--ring:#1f2937}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 800px at 50% -10%,#0f172a 0%,#0b1020 60%);color:var(--fg)}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:20px;margin:0;color:#cbd5e1}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:860px){.grid{grid-template-columns:1fr 1fr}}
    .row{display:grid;grid-template-columns:160px 1fr;gap:10px;align-items:center;margin:8px 0}
    label{color:var(--muted);font-size:13px}
    input[type=range]{width:100%}
    input[type=number]{width:100px}
    input[type=checkbox]{transform:scale(1.1)}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:14px;border:1px solid var(--ring);background:#0b1222;color:var(--fg);cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#0b1020;font-weight:700}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .toolbar{display:flex;flex-wrap:wrap;gap:10px}
    .pill{display:inline-flex;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--ring);background:#0c152a;color:#cbd5e1;font-size:12px;cursor:pointer}
    .on{outline:2px solid var(--accent)}
    .mono{font-variant-numeric:tabular-nums}
    footer{opacity:.7;font-size:12px;margin-top:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Hardbody Resonance — WebAudio PWA</h1>
      <div class="toolbar">
        <button id="installBtn" class="pill" hidden>Add to Home Screen</button>
        <button id="wakeBtn" class="pill" title="Prevent screen sleep while active">Keep Awake</button>
      </div>
    </header>

    <div class="grid">
      <!-- Transport -->
      <section class="card">
        <h3 style="margin-top:0">Transport</h3>
        <div class="toolbar" style="margin-bottom:10px">
          <button id="playBtn" class="btn primary">▶️ Play</button>
          <button id="stopBtn" class="btn">⏹ Stop</button>
          <div class="pill" id="countdown">00:00</div>
        </div>
        <div class="row">
          <label>Session length (min)</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="mins" min="1" max="90" step="1" value="10" style="flex:1">
            <input type="number" id="mins_num" class="mono" min="1" max="90" step="1" value="10">
          </div>
        </div>
        <div class="row">
          <label>Preset</label>
          <div class="toolbar">
            <button class="pill" data-preset="ground">Grounded 432</button>
            <button class="pill on" data-preset="expand">Expansive 528</button>
            <button class="pill" data-preset="focus">Focus Blend</button>
          </div>
        </div>
      </section>

      <!-- Base Tones -->
      <section class="card" id="baseSection">
        <h3 style="margin-top:0">Base Tones</h3>

        <!-- Base A -->
        <div class="row">
          <label for="freqA">Base A (Hz)</label>
          <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; width:100%">
            <input id="freqA" type="range" min="0" max="100" step="1" value="35" list="hzTicks" style="flex:1">
            <button type="button" class="pill" data-dec="freqA">−</button>
            <input id="freqA_num" class="mono" type="number" min="20" max="2000" step="1" value="528">
            <button type="button" class="pill" data-inc="freqA">+</button>
            <span id="freqA_readout" class="mono" style="min-width:70px; text-align:right"></span>
          </div>
        </div>

        <!-- Enable Base B -->
        <div class="row">
          <label for="base2On">Enable Base B</label>
          <input type="checkbox" id="base2On" checked>
        </div>

        <!-- Base B -->
        <div class="row">
          <label for="freqB">Base B (Hz)</label>
          <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; width:100%">
            <input id="freqB" type="range" min="0" max="100" step="1" value="27" list="hzTicks" style="flex:1">
            <button type="button" class="pill" data-dec="freqB">−</button>
            <input id="freqB_num" class="mono" type="number" min="20" max="2000" step="1" value="432">
            <button type="button" class="pill" data-inc="freqB">+</button>
            <span id="freqB_readout" class="mono" style="min-width:70px; text-align:right"></span>
          </div>
        </div>

        <!-- Levels + Binaural -->
        <div class="row">
          <label>Base A Level</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="base1Gain" min="0" max="2" step="0.01" value="1.00" style="flex:1">
            <input type="number" id="base1Gain_num" class="mono" min="0" max="2" step="0.01" value="1.00">
          </div>
        </div>
        <div class="row">
          <label>Base B Level</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="base2Gain" min="0" max="2" step="0.01" value="1.00" style="flex:1">
            <input type="number" id="base2Gain_num" class="mono" min="0" max="2" step="0.01" value="1.00">
          </div>
        </div>
        <div class="row"><label>Binaural Mode</label><input type="checkbox" id="binaural"></div>

        <p style="margin:6px 0 0;color:var(--muted);font-size:12px">
          Tip: tiny speakers won’t reproduce sub‑bass (≤60Hz). Use headphones or a real speaker for 40–80Hz work.
        </p>
      </section>

      <!-- ticks for log sliders -->
      <datalist id="hzTicks">
        <option value="0"  label="20"></option>
        <option value="14" label="40"></option>
        <option value="27" label="80"></option>
        <option value="41" label="160"></option>
        <option value="55" label="320"></option>
        <option value="69" label="640"></option>
        <option value="83" label="1280"></option>
        <option value="100" label="2000"></option>
      </datalist>

      <!-- Pulse & Sweep -->
      <section class="card">
        <h3 style="margin-top:0">Pulse & Sweep</h3>
        <div class="row">
          <label>Pulse (AM) Hz</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="pulse" min="0.2" max="3" step="0.1" value="1.5" style="flex:1">
            <input type="number" id="pulse_num" class="mono" min="0.2" max="3" step="0.1" value="1.5">
          </div>
        </div>
        <div class="row"><label>Enable Sweep</label><input type="checkbox" id="sweepOn" checked></div>
        <div class="row">
          <label>Sweep Low (Hz)</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="swLow" min="20" max="1000" step="1" value="80" style="flex:1">
            <input type="number" id="swLow_num" class="mono" min="20" max="1000" step="1" value="80">
          </div>
        </div>
        <div class="row">
          <label>Sweep High (Hz)</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="swHigh" min="40" max="2000" step="1" value="800" style="flex:1">
            <input type="number" id="swHigh_num" class="mono" min="40" max="2000" step="1" value="800">
          </div>
        </div>
        <div class="row">
          <label>Sweep Period (s)</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="swPeriod" min="5" max="60" step="1" value="20" style="flex:1">
            <input type="number" id="swPeriod_num" class="mono" min="5" max="60" step="1" value="20">
          </div>
        </div>
        <div class="row">
          <label>Sweep Level</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="swGain" min="0" max="1" step="0.01" value="0.30" style="flex:1">
            <input type="number" id="swGain_num" class="mono" min="0" max="1" step="0.01" value="0.30">
          </div>
        </div>
      </section>

      <!-- Output -->
      <section class="card">
        <h3 style="margin-top:0">Output</h3>
        <div class="row">
          <label>Master Level</label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input type="range" id="master" min="0" max="1" step="0.01" value="0.85" style="flex:1">
            <input type="number" id="master_num" class="mono" min="0" max="1" step="0.01" value="0.85">
          </div>
        </div>
        <div class="row"><label>High‑pass (sub‑safe)</label><input type="checkbox" id="hipass"></div>
        <footer>Start low. Low‑freq + AM can feel louder than expected.</footer>
      </section>
    </div>

    <footer style="margin-top:18px">Add to Home Screen for the cleanest experience. Background play depends on iOS rules (PWA behavior may vary by version).</footer>
  </div>

<script>
(()=> {
  /* ---------- PWA manifest & service worker ---------- */
  const manifest = {
    name: "Hardbody Resonance",
    short_name: "Resonance",
    start_url: ".",
    display: "standalone",
    background_color: "#0b1020",
    theme_color: "#0f172a",
    icons: [{ src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%230f172a'/%3E%3Ccircle cx='256' cy='256' r='190' fill='%233b82f6'/%3E%3Ccircle cx='256' cy='256' r='120' fill='%2394a3b8'/%3E%3C/svg%3E", sizes: "512x512", type: "image/svg+xml" }]
  };
  const mblob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
  const murl = URL.createObjectURL(mblob);
  const link = document.createElement('link'); link.rel='manifest'; link.href=murl; document.head.appendChild(link);

  const swCode = `self.addEventListener('install',e=>{e.waitUntil(caches.open('res-cache-v1').then(c=>c.addAll(['./'])))});
  self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
  if('serviceWorker' in navigator){
    const swBlob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swUrl);
  }

  /* ---------- DOM refs ---------- */
  const $ = id=>document.getElementById(id);
  const playBtn=$('playBtn'), stopBtn=$('stopBtn'), countdown=$('countdown');

  // Transport
  const mins=$('mins'), mins_num=$('mins_num');

  // Base
  const base2On=$('base2On'), binaural=$('binaural');
  const base1Gain=$('base1Gain'), base1Gain_num=$('base1Gain_num');
  const base2Gain=$('base2Gain'), base2Gain_num=$('base2Gain_num');

  // Freq controls (log scale)
  const freqA=$('freqA'), freqA_num=$('freqA_num'), freqA_readout=$('freqA_readout');
  const freqB=$('freqB'), freqB_num=$('freqB_num'), freqB_readout=$('freqB_readout');

  // Pulse & Sweep
  const pulse=$('pulse'), pulse_num=$('pulse_num');
  const sweepOn=$('sweepOn');
  const swLow=$('swLow'), swLow_num=$('swLow_num');
  const swHigh=$('swHigh'), swHigh_num=$('swHigh_num');
  const swPeriod=$('swPeriod'), swPeriod_num=$('swPeriod_num');
  const swGainCtl=$('swGain'), swGain_num=$('swGain_num');

  // Output
  const master=$('master'), master_num=$('master_num');
  const hipassCtl=$('hipass');

  /* ---------- Web Audio graph ---------- */
  let ctx, masterGain, hipass, leftBus, rightBus, pannerL, pannerR;
  let base1Osc, base2Osc, base1Amp, base2Amp, pulseOsc, pulseGain, amBias, amDepth, swOsc, swGain;
  let secondsLeft=0, countdownId;

  function initAudio(){
    if(ctx) return;
    ctx = new (window.AudioContext||window.webkitAudioContext)({sampleRate:44100});

    masterGain = ctx.createGain(); masterGain.gain.value = +master.value;
    hipass = ctx.createBiquadFilter(); hipass.type='highpass'; hipass.frequency.value = hipassCtl.checked? 80: 5;

    // L/R buses and panners (for binaural)
    leftBus = ctx.createGain(); rightBus = ctx.createGain();
    pannerL = ctx.createStereoPanner(); pannerR = ctx.createStereoPanner();
    pannerL.pan.value = 0; pannerR.pan.value = 0;

    // Pulse (AM) -> 0.5 bias + 0.5*sin
    pulseOsc = ctx.createOscillator(); pulseOsc.type='sine'; pulseOsc.frequency.value= +pulse.value;
    pulseGain = ctx.createGain(); pulseGain.gain.value = 0.5;
    amBias = ctx.createConstantSource(); amBias.offset.value = 0.5; amBias.start();
    amDepth = ctx.createGain(); amDepth.gain.value = 0.5;
    pulseOsc.connect(amDepth); amDepth.connect(pulseGain); amBias.connect(pulseGain);

    // Base oscillators + amps
    base1Osc = ctx.createOscillator(); base1Osc.type='sine'; base1Osc.frequency.value= +freqA_num.value;
    base1Amp = ctx.createGain(); base1Amp.gain.value = +base1Gain.value;

    base2Osc = ctx.createOscillator(); base2Osc.type='sine'; base2Osc.frequency.value= +freqB_num.value;
    base2Amp = ctx.createGain(); base2Amp.gain.value = +base2Gain.value;

    // Apply AM to both
    pulseGain.connect(base1Amp.gain); pulseGain.connect(base2Amp.gain);

    // Connect bases to L/R buses
    base1Osc.connect(base1Amp); base1Amp.connect(leftBus); base1Amp.connect(rightBus);
    base2Osc.connect(base2Amp); base2Amp.connect(leftBus); base2Amp.connect(rightBus);

    // Sweep overlay
    swOsc = ctx.createOscillator(); swOsc.type='sine';
    swGain = ctx.createGain(); swGain.gain.value = +swGainCtl.value;
    swOsc.connect(swGain); swGain.connect(leftBus); swGain.connect(rightBus);

    // Mix to output
    leftBus.connect(pannerL); rightBus.connect(pannerR);
    const merger = ctx.createGain(); pannerL.connect(merger); pannerR.connect(merger);
    merger.connect(hipass).connect(masterGain).connect(ctx.destination);

    // start
    base1Osc.start(); base2Osc.start(); pulseOsc.start(); swOsc.start();

    // expose for UI
    window.setBaseFreq = (which, hz)=>{
      const t = ctx.currentTime;
      if(which==='A' && base1Osc) base1Osc.frequency.setValueAtTime(hz, t);
      if(which==='B' && base2Osc) base2Osc.frequency.setValueAtTime(hz, t);
    };
  }

  /* ---------- Log scale for Base A/B (20..2000 Hz <-> 0..100) ---------- */
  const HZ_MIN=20, HZ_MAX=2000;
  const logMin=Math.log10(HZ_MIN), logMax=Math.log10(HZ_MAX);
  const sliderToHz = s => Math.round(Math.pow(10, logMin + (logMax-logMin)*(s/100)));
  const hzToSlider = hz => Math.round( ((Math.log10(hz)-logMin)/(logMax-logMin))*100 );

  function wireFreqControl(side, sliderEl, numEl, readoutEl, initialHz){
    const key = `freq_${side}_hz`;
    const saved = +localStorage.getItem(key);
    const startHz = (saved>=HZ_MIN && saved<=HZ_MAX) ? saved : initialHz;

    function setHz(hz){
      hz = Math.max(HZ_MIN, Math.min(HZ_MAX, Math.round(hz)));
      sliderEl.value = hzToSlider(hz);
      numEl.value = hz;
      readoutEl.textContent = hz + " Hz";
      localStorage.setItem(key, hz);
      if(window.setBaseFreq) window.setBaseFreq(side, hz);
    }

    sliderEl.value = hzToSlider(startHz);
    numEl.value = startHz;
    readoutEl.textContent = startHz + " Hz";

    sliderEl.addEventListener('input', ()=> setHz(sliderToHz(+sliderEl.value)));
    numEl.addEventListener('input', ()=> setHz(+numEl.value || HZ_MIN));

    const incBtn = document.querySelector(`[data-inc="${sliderEl.id}"]`);
    const decBtn = document.querySelector(`[data-dec="${sliderEl.id}"]`);
    if(incBtn) incBtn.addEventListener('click', ()=> setHz(+numEl.value + 1));
    if(decBtn) decBtn.addEventListener('click', ()=> setHz(+numEl.value - 1));

    $('playBtn').addEventListener('click', ()=> setTimeout(()=> setHz(+numEl.value), 50));
  }

  wireFreqControl('A', freqA, freqA_num, freqA_readout, 528);
  wireFreqControl('B', freqB, freqB_num, freqB_readout, 432);

  /* ---------- Linear slider <-> number pair helper ---------- */
  function linkSliderNumber(slider, number, {min, max, step}={}){
    const clamp=v=>Math.min(+max ?? +slider.max, Math.max(+min ?? +slider.min, v));
    const decimals=(step??slider.step).toString().split('.')[1]?.length||0;
    const syncFromSlider=()=>{ number.value=(+slider.value).toFixed(decimals); };
    const syncFromNumber=()=>{ slider.value = clamp(+number.value); };
    slider.addEventListener('input', syncFromSlider);
    number.addEventListener('input', ()=>{ number.value = clamp(+number.value); syncFromNumber(); });
    syncFromSlider();
  }

  // link all pairs
  linkSliderNumber(mins, mins_num,   {min:1, max:90, step:1});
  linkSliderNumber(base1Gain, base1Gain_num, {min:0, max:2, step:0.01});
  linkSliderNumber(base2Gain, base2Gain_num, {min:0, max:2, step:0.01});
  linkSliderNumber(pulse, pulse_num, {min:0.2, max:3, step:0.1});
  linkSliderNumber(swLow, swLow_num, {min:20, max:1000, step:1});
  linkSliderNumber(swHigh, swHigh_num, {min:40, max:2000, step:1});
  linkSliderNumber(swPeriod, swPeriod_num, {min:5, max:60, step:1});
  linkSliderNumber(swGainCtl, swGain_num, {min:0, max:1, step:0.01});
  linkSliderNumber(master, master_num, {min:0, max:1, step:0.01});

  /* ---------- Engine param updater ---------- */
  function updateParams(){
    if(!ctx) return;
    const now = ctx.currentTime;

    // Base freqs (from number boxes maintained by log sliders)
    base1Osc.frequency.setTargetAtTime(+freqA_num.value, now, 0.02);
    base2Osc.frequency.setTargetAtTime(+freqB_num.value, now, 0.02);

    // Gains + Base2 enable
    const b2on = base2On.checked;
    base1Amp.gain.setTargetAtTime(+base1Gain_num.value, now, 0.05);
    base2Amp.gain.setTargetAtTime(b2on ? +base2Gain_num.value : 0.0, now, 0.05);

    // Pulse
    pulseOsc.frequency.setTargetAtTime(+pulse_num.value, now, 0.05);

    // Sweep
    const low = Math.min(+swLow_num.value, +swHigh_num.value - 1);
    const high = Math.max(low+1, +swHigh_num.value);
    const period = Math.max(5, +swPeriod_num.value);
    swGain.gain.setTargetAtTime((sweepOn.checked ? +swGain_num.value : 0), now, 0.05);

    swOsc.frequency.cancelScheduledValues(now);
    swOsc.frequency.setValueAtTime(low, now);
    swOsc.frequency.linearRampToValueAtTime(high, now + period/2);
    swOsc.frequency.linearRampToValueAtTime(low,  now + period);

    // Output
    masterGain.gain.setTargetAtTime(+master_num.value, now, 0.05);
    hipass.frequency.setTargetAtTime(hipassCtl.checked?80:5, now, 0.1);

    // Binaural: hard pan L/R when on, center when off
    const isBin = binaural.checked;
    if (isBin){ pannerL.pan.setTargetAtTime(-1, now, 0.1); pannerR.pan.setTargetAtTime(1, now, 0.1); }
    else      { pannerL.pan.setTargetAtTime(0,  now, 0.1); pannerR.pan.setTargetAtTime(0, now, 0.1); }
  }

  /* ---------- Transport ---------- */
  function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }
  function setCountdown(min){ const v=Math.max(1, Math.min(90, +min|0)); secondsLeft=v*60; countdown.textContent=fmt(secondsLeft); }
  function tick(){ secondsLeft--; if(secondsLeft<=0){ stop(); } else { countdown.textContent=fmt(secondsLeft); } }

  function play(){
    initAudio();
    ctx.resume();
    setCountdown(+mins_num.value);
    clearInterval(countdownId); countdownId = setInterval(tick, 1000);
    playBtn.disabled=true; stopBtn.disabled=false;
    updateParams(); // push current UI to engine
  }
  function stop(){
    if(!ctx) return;
    clearInterval(countdownId); countdown.textContent = '00:00';
    playBtn.disabled=false; stopBtn.disabled=true;
    ctx.suspend();
  }

  /* ---------- UI wiring ---------- */
  [
    mins, mins_num,
    base1Gain, base1Gain_num, base2Gain, base2Gain_num, base2On, binaural,
    pulse, pulse_num, sweepOn, swLow, swLow_num, swHigh, swHigh_num, swPeriod, swPeriod_num, swGainCtl, swGain_num,
    master, master_num, hipassCtl,
    freqA, freqA_num, freqB, freqB_num
  ].forEach(el => el && el.addEventListener('input', updateParams));

  document.querySelectorAll('[data-preset]').forEach(b=>{
    b.addEventListener('click', ()=>{
      document.querySelectorAll('[data-preset]').forEach(x=>x.classList.remove('on'));
      b.classList.add('on');
      const p=b.dataset.preset;
      if(p==='ground'){ freqA_num.value=432; pulse_num.value=1.2; swLow_num.value=60; swHigh_num.value=600; swPeriod_num.value=24; master_num.value=0.85; }
      if(p==='expand'){ freqA_num.value=528; pulse_num.value=1.5; swLow_num.value=80; swHigh_num.value=800; swPeriod_num.value=20; master_num.value=0.85; }
      if(p==='focus'){  freqA_num.value=510; pulse_num.value=1.0; swLow_num.value=120; swHigh_num.value=720; swPeriod_num.value=18; master_num.value=0.80; }
      updateParams();
      if(window.setBaseFreq) window.setBaseFreq('A', +freqA_num.value);
    });
  });

  playBtn.addEventListener('click', play);
  stopBtn.addEventListener('click', stop);

  /* ---------- Install prompt ---------- */
  let deferredPrompt; const installBtn = document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; installBtn.hidden=false; });
  installBtn.addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.hidden=true; });

  /* ---------- Wake Lock ---------- */
  const wakeBtn = document.getElementById('wakeBtn'); let wakeLock=null;
  async function requestWake(){ try{ wakeLock = await navigator.wakeLock.request('screen'); wakeBtn.classList.add('on'); wakeLock.addEventListener('release',()=>wakeBtn.classList.remove('on')); }catch(e){ console.log('WakeLock failed',e) } }
  wakeBtn.addEventListener('click', ()=>{ if(wakeLock){ wakeLock.release(); wakeLock=null; wakeBtn.classList.remove('on'); } else { requestWake(); } });
})();
</script>
</body>
</html>
